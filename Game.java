package Game;

import java.util.ArrayList;
import java.util.List;
import java.util.Random;

/**
 * L√≥gica do jogo.
 * O servidor chama esses m√©todos para validar e aplicar jogadas.
 * Clientes apenas exibem mensagens.
 */
public class Game {

    // =========================
    // Estado principal
    // =========================
    private final List<Player> players = new ArrayList<>();
    private int currentPlayerIndex = 0;

    private int bulletsInChamber;
    private int realBullets;
    private int fakeBullets;

    private final Random rng = new Random();

    private String pendingAmmoInfo = null;

    // =========================
    // Tipos de resultado do tiro
    // =========================
    public enum ShotType {
        HIT, MISS, RELOAD, INVALID
    }

    // =========================
    // Artes ASCII
    // =========================
    public static final String HIT_ART =
"‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚£¥‚¢∂‚£∂‚£∂‚†º‚£¶‚£§‚£º‚£º‚°Ü‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä\n" +
"‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£†‚†ñ‚£Ø‚†ø‚†ü‚†õ‚†ª‚¢∂‚£ø‚£Ø‚£ø‚£ø‚£É‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä\n" +
"‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£†‚£ñ‚£∫‚°ø‚†ø‚†∑‚†∂‚†í‚¢∂‚£∂‚†ñ‚†Ä‚†â‚°ª‚¢ª‚£ø‚°á‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä\n" +
"‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£¥‚¢ª‚£≠‚£´‚£ø‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚£æ‚†É‚¢Ä‚°è‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä\n" +
"‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚£ñ‚°ø‚†ã‚¢ô‚£ø‚†ø‚¢ø‚†ø‚£ø‚°¶‚†Ñ‚†Ä‚†Ä‚†Ä‚£†‚£æ‚†ü‚†Ä‚†Ä‚£º‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä\n" +
"‚†Ä‚†Ä‚¢Ä‚£∞‚£ø‚£¥‚£ø‚°ø‚†ø‚†ø‚†ø‚¢ø‚£¶‚£Ñ‚†Ä‚†Ä‚†Ä‚£†‚£æ‚£ø‚†É‚†Ä‚¢Ä‚£∏‚°ø‚£≥‚£∂‚£≤‚°Ñ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä\n" +
"‚†Ä‚†Ä‚£æ‚£Ω‚°ø‚£õ‚£µ‚†æ‚†ø‚†ø‚†∑‚£¶‚£å‚†ª‚£∑‚£Ñ‚¢∞‚£ø‚†ü‚†Å‚†Ä‚¢†‚£æ‚†ø‚¢°‚£Ø‚†∏‚†ß‚¢Ω‚£Ñ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä\n" +
"‚†Ä‚¢∏‚°á‚°ü‚£¥‚°ø‚¢ü‚£Ω‚£æ‚£ø‚£∂‚£å‚†ª‚£ß‚£π‚£ø‚°ø‚†ã‚†Ä‚†Ä‚†Ä‚£æ‚†ø‚°á‚£Ω‚£ø‚£Ñ‚†Ä‚†Ä‚†â‚†≥‚£Ñ‚¢Ä‚°Ä‚†Ä\n" +
"‚†Ä‚¢∏‚†á‚¢≥‚£ø‚¢≥‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚°Ü‚¢π‚°á‚£ø‚°á‚†Ä‚°Ü‚£†‚£º‚°è‚¢∞‚£ø‚£ø‚£ø‚£ø‚£¶‚†Ä‚†Ä‚†Ä‚†à‚†≥‚£Ö‚†Ä\n" +
"‚†Ä‚£∏‚°Ä‚¢∏‚£ø‚¢∏‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚°á‚£∏‚°á‚£ø‚°á‚†Ä‚°ü‚£ª‚¢≥‚£∑‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†ò‚£ß\n" +
"‚¢∞‚°ü‚°ø‚°Ü‚†π‚£ß‚°ô‚¢ø‚£ø‚£ø‚†ø‚°ü‚¢°‚£ø‚¢∑‚£ø‚£ß‚†æ‚¢†‚£ø‚£æ‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†ò\n" +
"‚†Ä‚†ª‚°Ω‚£¶‚†Ä‚†à‚†ô‚†≥‚¢∂‚£¶‚°∂‚†û‚¢ª‚°ü‚°∏‚†ü‚†Å‚¢†‚†ü‚†â‚†â‚†ô‚†ø‚£ø‚£ø‚£ø‚£ø‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚°¥\n" +
"‚†Ä‚†Ä‚¢∏‚£ø‚°á‚†Ä‚†Ä‚£Ä‚£†‚†Ä‚¢Ä‚°Ä‚†∏‚£π‚†á‚†Ä‚£∞‚°ü‚°Ä‚†Ä‚†à‚†õ‚†ª‚¢ø‚£ª‚£ø‚°ø‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚°†‚†Å\n" +
"‚†Ä‚†Ä‚¢∏‚£ø‚£á‚£¥‚¢ø‚£ø‚£ø‚£ø‚£Æ‚£ø‚£∑‚°ü‚†Ä‚£∞‚£ø‚¢∞‚†Ä‚£Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚£â‚£ø‚°á‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£∏‚†É‚†Ä\n" +
"‚†Ä‚†Ä‚¢∏‚£ø‚°ü‚£Ø‚†∏‚£ø‚£ø‚£ø‚£ø‚¢à‚£ø‚°á‚£º‚£ø‚†á‚£∏‚°¶‚£ô‚£∑‚£¶‚£¥‚£Ø‚†ø‚†õ‚¢∑‚°Ä‚†Ä‚†Ä‚†Ä‚£∞‚°ü‚†Ä‚†Ä\n" +
"‚†Ä‚†Ä‚†ò‚£ø‚£ø‚°∏‚£∑‚£ù‚†ª‚†ü‚¢ã‚£æ‚£ü‚£∞‚°è‚£†‚£§‚°ü‚†Ä‚†Ä‚†à‚†â‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚¢ª‚£∂‚†Ä‚¢Ä‚£ø‚†Å‚†Ä‚†Ä\n" +
"‚†Ä‚†Ä‚†Ä‚¢∏‚°ø‚£ø‚£¶‚£Ω‚£õ‚£õ‚£õ‚£≠‚£æ‚£∑‚°∂‚†û‚†ã‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£º‚£ø‚£ø‚°ü‚†Ä‚†Ä‚†Ä‚†Ä\n" +
"‚†Ä‚†Ä‚†Ä‚†Ä‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚°Ä‚†Å‚¢∏‚¢ª‚†Å‚†Ä‚†Ä‚†Ä‚†Ä\n" +
"‚†Ä‚†Ä‚†Ä‚†Ä‚°ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ß‚£§‚£§‚£Ä‚£Ä‚£Ä‚£Ä‚£Ä‚£†‚£§‚†∂‚†õ‚†Å‚¢Ä‚£æ‚°ü‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä\n" +
"‚†Ä‚†Ä‚†Ä‚†Ä‚¢ø‚£ª‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£é‚£ø‚°Ö‚†Ä‚†à‚†â‚†â‚†â‚†â‚†â‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚£º‚£ø‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä\n" +
"‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚¢ª‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£á‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚£†‚°∑‚†ü‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä\n" +
"‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†ô‚¢ø‚£ø‚£ø‚†ª‚¢ø‚£ø‚£ø‚£ü‚£Ç‚£Ä‚£Ä‚£Ä‚£Ä‚£Ä‚£Ä‚£§‚†¥‚†ã‚†Å‚£æ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä\n" +
"‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚¢ª‚£ø‚£∑‚£∑‚°Ñ‚†Ä‚†Ä‚†Ä‚†â‚†â‚†â‚†â‚†â‚†Ä‚†Ä‚†Ä‚¢Ä‚°û‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä\n" +
"‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†ª‚£ø‚£ø‚°Ü‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£†‚†ü‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä\n" +
"‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚£ø‚£∑‚£§‚£§‚£§‚£§‚£Ñ‚£§‚£§‚°§‚†¥‚†û‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä";


    public static final String MISS_ART =
"‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚°Ä‚°Ä‚†Ä‚¢Ñ‚†Ä‚°å‚†Ä‚°é‚°Ü‚£≤‚†§‚†Ä‚°Ä‚†Ä‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä\n" +
"‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚†Ä‚°Ä‚°Ä‚†Ñ‚†Ä‚†¢‚†Ñ‚°†‚£Å‚†Å‚¢ò‚†°‚£ë‚¢∫‚°ä‚†Ç‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä\n" +
"‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚†Ä‚†Ä‚†Ä‚†Å‚†Ä‚£Ä‚†Ä‚†Ü‚°á‚°ç‚£á‚£¶‚°Ü‚†¢‚†∂‚°á‚¢ã‚¢É‚°ñ‚†Ç‚†Ç‚†Ç‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä\n" +
"‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚°Ñ‚¢Ä‚†Å‚†Ä‚°Ä‚†Ä‚†Ä‚°ñ‚£Ñ‚°¶‚°¢‚°ü‚†Æ‚°ü‚†ã‚°á‚†Å‚†ä‚†Ñ‚†Ä‚†Ç‚¢Ç‚†ä‚†Ä‚†Ç‚†Ä‚†Ñ‚¢Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ñ‚†Ä‚†Ä‚†Ä‚††‚†Ä‚†Ä‚°Ä‚†Ä‚†Ä‚†Ä\n" +
"‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚°Ä‚†Ä‚°Ç‚†Ä‚†Ä‚†Ö‚†Ä‚†Ä‚°è‚°Å‚°ê‚†ô‚†â‚£É‚£ß‚°õ‚°è‚£Ä‚¢Ü‚£°‚£ê‚†É‚°°‚£Ñ‚°à‚†Å‚£Ç‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ñ‚†Ä‚†Ä‚†Ä‚†Ä\n" +
"‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚†Å‚†Ä‚†Ñ‚°Ä‚†ä‚†Ä‚†Ç‚†ã‚†Å‚°Ä‚¢∑‚£Å‚¢ù‚¢¢‚°Ö‚£ì‚°ã‚°©‚¢á‚†í‚°É‚†á‚¢†‚†Å‚†Ñ‚¢Å‚†Ç‚†Ñ‚£ê‚£Ä‚¢Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ç‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä\n" +
"‚†Ä‚†Ä‚†Ä‚††‚†Ä‚†Ö‚†Å‚††‚†Ä‚°à‚†Ä‚†Ñ‚°ä‚¢í‚°Å‚†Ü‚£∏‚£á‚¢£‚°å‚£É‚£π‚£è‚°ô‚£É‚†Ö‚°Ç‚£´‚††‚°§‚°£‚†ß‚°Ñ‚°Å‚†Ä‚†§‚†Ñ‚°†‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä\n" +
"‚†Ä‚†Ä‚†É‚†Ä‚°Ç‚¢Ä‚°å‚†Ñ‚†â‚°Å‚†Ü‚¢Ä‚†î‚†®‚°∞‚£É‚£´‚†Ö‚†¶‚£ß‚£¨‚¢ê‚£≤‚¢ã‚°É‚°ì‚†Ñ‚¢Ω‚†©‚†Ñ‚†è‚°Ñ‚†Ñ‚¢Ñ‚†Ä‚†î‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä\n" +
"‚††‚°Ñ‚†Ä‚†Å‚†Ä‚°Å‚†ç‚£É‚¢Ñ‚†Ç‚£å‚£ï‚¢Å‚†è‚†´‚†è‚£Å‚¢Ñ‚†°‚¢É‚†ô‚£ù‚¢ö‚°é‚°ì‚†â‚°Ä‚†ì‚°§‚†î‚¢Ç‚°ê‚†Ä‚°Ä‚°Å‚†à‚†Ä‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä\n" +
"‚†Ä‚†Ä‚£Ä‚°Ñ‚¢Ç‚°é‚£†‚£Ö‚†ï‚†Å‚¢É‚†Ä‚°å‚£Ä‚†Ö‚°Ä‚£µ‚°ë‚°Æ‚£•‚°Ö‚†ø‚†ì‚†â‚°Ñ‚°á‚†Ç‚†Ä‚†è‚°î‚†Ä‚¢Ö‚†°‚°à‚£â‚†í‚†ô‚†Ç‚†à‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä\n" +
"‚†Ä‚†ê‚†•‚†ä‚†ô‚†°‚†Ä‚†Ñ‚†¨‚††‚¢Å‚††‚°Ñ‚°à‚°á‚£Å‚†Ñ‚†Å‚†Ö‚†á‚°Ö‚£Ø‚°í‚¢ô‚¢£‚°Ö‚°á‚†ï‚†É‚°É‚£î‚†Ä‚°Ä‚¢Ç‚†í‚†Ä‚†Ä‚°Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä\n" +
"‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚††‚†Ü‚†à‚†Ç‚†Ä‚†Å‚†≤‚†Ä‚°á‚°Å‚°Ç‚†Ä‚†ê‚£Ç‚°á‚¢î‚°Ø‚£™‚£ë‚°Ç‚†Ñ‚¢é‚†Å‚†¢‚°Å‚¢Ç‚†à‚°•‚†Ö‚°ä‚†Ä‚†â‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä\n" +
"‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£Ä‚†Ä‚†Ä‚£†‚†Ä‚†Å‚°†‚°Ä‚¢Å‚°Ü‚¢í‚¢É‚£Å‚°Ä‚†Ü‚£á‚†ò‚†°‚°π‚†â‚°Å‚†Ñ‚†Å‚†é‚¢Ä‚†Ä‚°ä‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä\n" +
"‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†°‚†Ä‚†Ä‚¢Ä‚†Ç‚†Ä‚†Ü‚†á‚†Ç‚†ê‚†Ñ‚†Ä‚†Ñ‚†Ñ‚£á‚†±‚†®‚¢â‚°Ñ‚†Ü‚°†‚£á‚†â‚°É‚†É‚†Å‚°Å‚†à‚°Ä‚†Ä‚†Ä‚†Ç‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä\n" +
"‚†Ä‚†É‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä‚°Ä‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†É‚¢Ø‚†É‚†ì‚†Ö‚†Ñ‚†Ø‚¢∫‚¢ß‚†à‚†Å‚†Å‚†¶‚¢Ä‚¢Ä‚†Ä‚†ê‚†Ñ‚†Ç‚†í‚†Ç‚†ä‚†Ä‚°á‚¢Ä‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä\n" +
"‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚°Ä‚†Ä‚†Ä‚†Ç‚††‚†Ä‚†ê‚¢†‚°®‚†Ä‚°à‚°¥‚£Ñ‚£õ‚†£‚†í‚†î‚†Ü‚¢Å‚†Ñ‚°É‚°à‚†¢‚¢Ä‚†§‚††‚°Ü‚†ê‚†Ç‚†Å‚†Å‚¢Ç‚†Ä‚†Ñ‚°°‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä\n" +
"‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Å‚†Ä‚†Å‚†Ä‚¢Ä‚¢à‚†Ä‚†Ñ‚¢Ä‚†Ä‚†Ç‚¢í‚°Ä‚†Ñ‚†Ö‚†à‚¢ñ‚£Ç‚††‚°Å‚°®‚†à‚†Ä‚†Å‚†°‚†Ä‚†Ä‚†Ä‚†Ç‚†î‚†Ä‚†Ä‚†Ä‚°Ñ‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä\n" +
"‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ç‚†Ä‚†Ä‚°ã‚†Ä‚†Ä‚†∞‚¢Å‚†Ñ‚¢Ä‚†Ñ‚†è‚†Ä‚¢Ä‚†Å‚†Ç‚¢Ä‚†Å‚††‚†à‚†à‚†Ä‚¢Ä‚†Ä‚†Ä‚†Ä‚†Ç‚†à‚†Ä‚†Ä‚†ê‚†Ä‚£Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä\n" +
"‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†ê‚†Ä‚†Ä‚†ã‚†Ä‚†Ä‚†Å‚†Ä‚†ä‚°É‚†Ä‚†Ç‚†¢‚†°‚†Ñ‚†Ä‚††‚†à‚†Ç‚†Ä‚°Ä‚†Ä‚†Ä‚†à‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚°Ä‚†Ä‚†Ç‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä\n" +
"‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Å‚†Å‚†Ä‚¢Å‚†Ä‚†Ä‚†Ä‚°Ä‚†Ä‚†Ä‚†Ä‚††‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä\n";


    // =========================
    // Jogadores
    // =========================
    public void addPlayer(Player player) { players.add(player); }
    public List<Player> getPlayers() { return players; }
    public int getCurrentPlayerIndex() { return currentPlayerIndex; }
    public Player getCurrentPlayer() { return players.get(currentPlayerIndex); }

    // =========================
    // In√≠cio da partida
    // =========================
    public void resetMatch() {
        for (Player p : players) p.reset();
        currentPlayerIndex = 0;
        setupChamber();
        pendingAmmoInfo = getAmmoInfoString("üéÆ In√≠cio da partida");
    }

    private void setupChamber() {
        bulletsInChamber = 6;
        realBullets = 2 + rng.nextInt(3); // 2..4
        fakeBullets = bulletsInChamber - realBullets;
    }

    public int getBulletsInChamber() {
        return bulletsInChamber;
    }

    private String getAmmoInfoString(String prefix) {
        return prefix + " | Muni√ß√£o: ‚úÖ " + realBullets + " reais, ‚ùå " + fakeBullets + " falsas.";
    }

    public String consumePendingAmmoInfo() {
        String msg = pendingAmmoInfo;
        pendingAmmoInfo = null;
        return msg;
    }

    // =========================
    // Estado
    // =========================
    public String getStateString() {
        StringBuilder sb = new StringBuilder();
        sb.append("\n--- STATUS DOS JOGADORES ---\n");
        for (int i = 0; i < players.size(); i++) {
            Player p = players.get(i);
            sb.append(i + 1).append(") ")
              .append(p.getName())
              .append(" | Vida: ").append(p.getLife())
              .append(p.isAlive() ? "" : " ‚ò†")
              .append("\n");
        }
        sb.append("Balas restantes: ").append(bulletsInChamber).append("\n");
        return sb.toString();
    }

    // =========================
    // Valida√ß√£o
    // =========================
    public String validateShot(int shooterIndex, int targetIndex) {
        if (shooterIndex != currentPlayerIndex) return "ERRO: N√£o √© sua vez.";
        if (targetIndex < 0 || targetIndex >= players.size()) return "ERRO: Alvo inv√°lido.";
        if (!players.get(shooterIndex).isAlive()) return "ERRO: Voc√™ est√° morto.";
        if (!players.get(targetIndex).isAlive()) return "ERRO: O alvo j√° est√° morto.";
        return null;
    }

    // =========================
    // Resultado do tiro
    // =========================
    public static class ShotResult {
        public final String message;
        public final boolean extraTurn;
        public final ShotType type;

        public ShotResult(String message, boolean extraTurn, ShotType type) {
            this.message = message;
            this.extraTurn = extraTurn;
            this.type = type;
        }
    }

    // =========================
    // Processa tiro
    // =========================
    public ShotResult processShot(int shooterIndex, int targetIndex) {

        String validation = validateShot(shooterIndex, targetIndex);
        if (validation != null) {
            return new ShotResult(validation, true, ShotType.INVALID);
        }

        if (bulletsInChamber == 0) {
            setupChamber();
            pendingAmmoInfo = getAmmoInfoString("üîÑ Recarregou");
            return new ShotResult("üî´ Pente vazio! Recarregando...", true, ShotType.RELOAD);
        }

        Player shooter = players.get(shooterIndex);
        Player target = players.get(targetIndex);

        bulletsInChamber--;

        int total = realBullets + fakeBullets;
        boolean hit = rng.nextInt(total) < realBullets;

        if (hit) {
            realBullets--;
            target.loseLife();
            return new ShotResult("üí• BANG! " + shooter.getName() + " atirou em " + target.getName(), false, ShotType.HIT);
        } else {
            fakeBullets--;
            boolean extra = shooterIndex == targetIndex;
            return new ShotResult("üòÖ CLICK! " + shooter.getName() + " errou." , extra, ShotType.MISS);
        }
    }

    // =========================
    // Turnos
    // =========================
    public void advanceTurn() {
        do {
            currentPlayerIndex = (currentPlayerIndex + 1) % players.size();
        } while (!players.get(currentPlayerIndex).isAlive());
    }

    public boolean isGameOver() {
        return players.stream().filter(Player::isAlive).count() <= 1;
    }

    public int getWinnerIndexOrMinus1() {
        for (int i = 0; i < players.size(); i++) {
            if (players.get(i).isAlive()) return i;
        }
        return -1;
    }
}
